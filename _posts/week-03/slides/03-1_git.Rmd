---
title: "Week 3: Git and Github"
output:
  xaringan::moon_reader:
    seal: false
    css: ["default", "default-fonts", "slides.css"]
    lib_dir: libs
    nature:
      highlightStyle: rainbow
      highlightLines: true
      countIncrementalSlides: false
---
class:inverse middle center

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)

knitr::opts_chunk$set(eval = FALSE)
```

## *Week 3: <br> Git and Github*

----

# Part I: Getting started with Git

<br> <br> <br> <br> <br>

### Jelmer Poelstra
### 2021/01/26 (updated: `r Sys.Date()`)

---

## What is version control?

...

<p align="left">
<img src=img/w03/git-scm-snapshots.png width="90%">
</p>
  

---


## Why use version control?

- "History of changes"

- Time machine for your project   

- Simultaneous collaborative work

- By using *branches*:
  
  - No worries about breaking things that work.
  
  - Make (experimental) changes without affecting others work,
    but staying up-to-date with the main project.

- Makes sharing your code easy

<br>

> *Version control is a way to keep your scientific projects tidily organized,*
> *collaborate on science, and have the whole history of each project at your*
> *fingertips.*  
> &mdash; CSB

---

## What are Git and Github?

- **Git** is the most widely used software for version control

<br>

- **Github** is the most widely used *website* to host Git repositories.

  Github can be linked up to Git so you can sync your repositories from the
  command line.

---

## Key concepts

- A "repository" (or "repo") ...

- A "commit" is a saved snapshot of the project

- Git saves *differences* between commits, it does not keep copies of all files
  or even the entire changed files for every commit.

---

## What do I put under version control?

- Commit the source, not the derived files

- Raw data may or may not be committed

- Binary files can't be tracked effectively

Limitations:
  - Repository size (best to keep under 1 GB)
  - File size (Github will not allow files over 100 MB)
  - File type

- The general model of Git is that one repository corresponds to everything
  inside a single directory structure (last week's project organization!),
  but you can instruct Git to ignore certain files.

---

## Using Git

- GUIs, IDEs, and command-line usage

- Every git command is called using: `git <(sub)command>`: `git config`, 
  `git status`, etc.
  
  Like bash, most of these commands can also take *options* and *arguments*.

---

## CSB 2.4.1: Basic Workflow

Only three commands tend to make up the vast majority of your Git work:

- **`git status`**  
  Will report the status of your repository: which files have changed,
  which new files are present, etc.
  
- **`git add`**  
  *Stages* files to be committed (including previously untracked files).

- **`git commit`**  
  Commits all currently staged changes.

[TODO: ADD IMG]

---

## Misc. git commands

- **`git init`**  

- **`git log`**  

- **`git diff`**  
  [EXPAND A BIT ON DIFF?]

- **`git rm`** and **`git mv`**

---

## CSB 2.4.3: Using a `.gitignore` file

[ADD A COUPLE OF COMMANDS TO ADD UNWANTED FILE, THEN CREATE AND COMMIT .GITIGNORE]

---

## CSB 2.4.5: Troubleshooting Git

### Undoing unstaged changes

```sh
echo "todo: ask sequencing center about adapters" > readme.md
cat readme.md # oops
git status    # git tells us how to undo our change
git checkout -- readme.md # to checkout 'readme.md' from the last commit
git restore readme.md     # same, with more recent version of git
cat readme.md # yes!
git status
```

---

## CSB 2.4.5: Troubleshooting Git (cont.)

### Unstaging a file

- You can use `git reset` to unstage a file, so you can change a mistake you made.

  ```sh
  echo "XXX" > README.md
  git status              # git status will tell us what to do!
  
  git reset HEAD README.md
  ```
  
- But this will not revert the file back to its state at the last commit
  (cf. CSB &ndash; mistake!).
  
- Often when you've made a mistake, or when you just prematurely staged,
  unstaging is all you need,
  but sometimes you do need to revert back to a previously saved version.
  
---

## CSB 2.4.5: Troubleshooting Git (cont.)

### Undoing staged changes

```sh
echo "todo: ask sequencing center about adapters" > readme.md
git add readme.md
git reset HEAD readme.md
cat readme.md # mistake still there, but unstaged

git status

git checkout -- readme.md
cat readme.md # yes!
```

[ADD FIGURE SHOWING CHECKOUT AND RESET!]

---

## CSB 2.5: Remote repositories

---

## CSB 2.6: Branching and merging

---

## CSB 2.6: Branching and merging (cont.)

### Merge conflicts

```sh
code <conflicting-file> # Show features!
```

---

## What can you do with someone else's GitHub repository?

If you do not have push rights:
  - You can clone the repository and make changes locally, but you cannot push your changes
  - You can fork their repository and develop it independently
  - You can submit a pull request to their repository if you want to contribute to the original project
  - (You can contact the owner of the repository and ask them to include you as a
    contributor and give you push rights.)

---

## Some Git best practices

- Write informative commit messages -- imagine looking back at your project
  in a few months, after finding an error that you introduced a while ago.

- Commit often, using small commits -- will also help to keep commit messages informative.

- Before committing, check what you've changed using `git diff`.

- If you've worked on multiple disparate things before committing,
  create two separate commits: `git add` + `git commit` separately for two
  sets of files.

- When collaborating, pull often.

- Don't commit unnecessary files, which can also lead to conflicts.

---

## More on commit messages

- Bad: "Updated file"
- Good: "Updated x function to include y"


---

## Github

- Note that a `README` file (usually `README.md`) in the top level of the repo
  will always show up, rendered, on the front page of your repo.
  
- Show forking and how this is displayed in the forked repo.
  - Make a change
  - Will say "1 commit ahead" -> Click `Compare`
  - `Create Pull Request`

- Show Issues pointing to Pull Requests and vice versa?

---

## Misc.

- If you want a GUI for Git, I've heard good things about `GitKraken`,
  and it available for Windows, Mac, and Linux.

- Zenodo for getting a DOI when publishing (see <https://github.com/ngs-docs/2020-GGG298/blob/master/Week6-Git_and_GitHub_for_file_tracking_and_sharing/README.md>)

---
class: inverse middle center

# Bonus Materials

----

---

## Bonus: Undoing committed changes

- Create a new commit that will revert all the changes made in a previous commit
  (the last commit in this example):

```sh
git revert HEAD
```

- This will work and be safe both for commits that were and that were not
  pushed online.
  
---

## Bonus: Checking out previous versions

- Get a version of a file from a past commit:

  ```sh
  git checkout HEAD~2 -- README.md
  git checkout 3ba6674 -- README.md
  
  less README.md  # This will now be "the old version"
  git status   # "The old version" has been staged
  ```

- Nope, please take me back to my current version:

  ```sh
  git checkout HEAD -- README.md
  less README.md  # Phew!
  git status   # Up-to-date
  ```

- Another possibility:
  ```sh
  git show 3ba6674:README.md
  
  git show 3ba6674:README.md > README.md
  ```

<br>

- Look at state of entire project in a previous commit:

  ```sh
  git checkout HEAD~2
  git checkout 3ba6674
  ```
  
- This is best just for looking around, to go back:


- Or if you want to permanently move back to that state of the project:
  ```sh
  git revert HEAD~2
  ```
