<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Week 11 - Python: Scientific computing</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="slides.css" type="text/css" />
    <link rel="stylesheet" href="slides_copy.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class:inverse middle center





# *Week 11 - Python: Scientific computing*

----

# I (Tuesday)

&lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt;

### Jelmer Poelstra
### 2021/03/23 (updated: 2021-03-15)

---

## Overview of this week

.pull-left[
**Tuesday's presentation**

- NumPy and SciPy (CSB 6.2)

]

.pull-right[
**Today's presentation:**

- Pandas (CSB 6.3)

- BioPython (CSB 6.4)
]

&lt;br&gt; &lt;br&gt;

---
class: center middle inverse

# Pandas (CSB 6.3)

-----

&lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt;

---

## Pandas

Pandas is short for Python Data Analysis Library.
With its `Series` and especially `DataFrame`s,
you can do similar analyses to what is typically done in R using the *tidyverse*.

```python
import pandas as pd
import numpy as np
```

Like in R, we don't read files in line-by-line but load them all at once:

```python
import os
os.chdir('/fs/ess/PAS1855/users/&lt;user&gt;/CSB/scientific/data')
# os.chdir('../CSB/scientific/sandbox')

data = pd.read_csv("../data/Dale2015_data.csv")
```

---

## Exploring DataFrames

- Show the first 6 rows with `head()`:

  ```python
  data.head()
  ```

- Check the dimensions:

  ```python
  data.shape
  (5831, 5)
  ```

- Get the column names with `columns()`, which returns an `Index` object:

  ```python
  Index(['Scientific_name', 'English_name', 'TipLabel',
         'Female_plumage_score', 'Male_plumage_score'],
         dtype='object')
  ```
  
---

## Manipulating DataFrames

- Create a new column that sums the plumage score for males and females:

  ```python
  data["Sum_scores"] = data["Female_plumage_score"] + data["Male_plumage_score"]
  
  data.head()
  ```

- We could also add a column with a constant &amp;ndash; a vectorized operation,
  like we have seen with NumPy:
  
  ```python
  data["Study"] = 1
  ```

- Or we could add a column of random numbers &amp;ndash;
  note that we can quickly get the correct number of rows using `data.shape[0]`:
  
  ```python
  data["Rnd"] = np.random.random(data.shape[0])
  ```

---

## Manipulating DataFrames (cont.)

- We can use `del()` to drop one column,
  or `drop()` to remove one or more columns:
  
  ```python
  del(data["Sum_scores"])
  
  data.drop(["Rnd", "Study"], axis = 1, inplace = True)
  ```
  
  - `axis = 0` acts along rows, and `axis = 1` along columns.
  - `inplace` means that the `DataFrame` is modified in place.

---

## Indexing DataFrames

- First, note that we can specify columns not just using `df["colname"]` but      also using `df.colname`:
  
  ```python
  data["Scientific_name"]
  
  data.Scientific_name
  ```

- Next, we can index the resulting `Series` (1-dimensional array) like we are
  used to:
  
  ```python
  data["Scientific_name"][:3]
  #&gt; 0 Abroscopus albogularis
  #&gt; 1 Abroscopus schisticeps
  #&gt; 2 Abroscopus superciliaris
  
  data.Scientific_name[:3]
  #&gt; 0 Abroscopus albogularis
  #&gt; 1 Abroscopus schisticeps
  #&gt; 2 Abroscopus superciliaris
  ```

---

## Indexing DataFrames (cont.)

- But we can't index the entire DataFrame the way we may expect to:

  ```python
  data[0:3, 0:3]
  #&gt; TypeError: '(slice(0, 3, None), slice(0, 3, None))' is an invalid key
  ```

- Instead we need to use the method `iloc()`:
  
  ```python
  data.iloc[2, 1]
  #&gt; 'Yellow-bellied Warbler'
  ```
  
  Add more
  
---

## Indexing DataFrames (cont.)

We can also use `loc`, which selects rows and columns using **labels** ...

```python
data.loc[:3, ["Scientific_name", "English_name"]]
#&gt; 0 Abroscopus albogularis Rufous-faced Warbler
#&gt; 1 Abroscopus schisticeps Black-faced Warbler
#&gt; 2 Abroscopus superciliaris Yellow-bellied Warbler
#&gt; 3 Acanthagenys rufogularis Spiny-cheeked Honeyeater

data.loc[data.Scientific_name == "Zosterops mouroniensis"]
# Scientific_name	English_name	TipLabel	Female_plumage_score	Male_plumage_score	Sum_scores	Study
# 5801	Zosterops mouroniensis	Mount Karthala White-eye	Zosterops_mouroniensis	47.916667	47.5	95.416667	1
```

---

## Indexing DataFrames (cont.)

- We can even select rows based on only part of the cell content:

  ```python
  data[data.English_name.str.contains("Bowerbird")]
  #&gt; [Shows all rows with Bowerbirds]
  
  data[data.English_name.str.contains("Bowerbird")]["Scientific_name"][:3]
  #&gt; 188 Amblyornis flavifrons
  #&gt; 189 Amblyornis inornata
  #&gt; 190 Amblyornis macgregoriae
  #&gt; Name: Scientific_name, dtype: object
  ```
---

## Filtering rows

```python
high_male_score = data[data["Male_plumage_score"] &gt; 65]
```

```python
highly_dimorphic = data[(data.Male_plumage_score &gt; 70) &amp; \
                        (data.Female_plumage_score &lt; 40)]
```

One important feature of pandas is that many commands return a view,
as opposed to a copy of the data. A simple example:

```python
high_male_score["Qualitative_score"] = "High"
#&gt; [...] SettingWithCopyWarning:
#&gt; A value is trying to be set on a copy of a slice from a DataFrame.
```

---

## Copy and modify


---

## Some simple plots

```python
%matplotlib inline
```

Histogram:

```python
data.Male_plumage_score.hist()
```

Scatterplot:

```python
data.plot.scatter(x = "Male_plumage_score", y = "Female_plumage_score")
```

Boxplot:

```python
data[["Male_plumage_score", "Female_plumage_score"]].plot.box()
```

---

## Intermezzo 6.2

Gächter and Schulz (2016) performed a provocative experiment to study
intrinsic honesty in different countries. Groups of students were asked to per-
form two rolls of a fair die, and to report the result of the first roll. They
were paid an amount of money proportional to the reported number, with
the exception that they were given no money when they reported rolling a 6.

The subjects knew of the monetary reward, and that their rolls were
private—the experimenters could not determine whether they were telling
the truth or not. If everybody were to tell the truth, we would expect that each
claim (from 0 to 5 monetary units) would be equally represented in the data,
with a proportion of 16 = 0.16. Countries where cheaters were more abundant
would have a higher proportion of subjects claiming a reward of 5 units and
a lower proportion of those claiming 0 units.

1. Load the file ( data/Gachter2016_data.csv ) using pandas . Which
country reported the smallest frequency of Claim == 0 (meaning
fewest honest players)? Which the highest?

2. Now calculate the reported frequency of rolling the number 5 (which
would lead to a claim of 5 units) for each country. Which country has
the lowest frequency (most honest players)? Which the highest? Notice
that the data report cumulative frequencies; to obtain the frequency of
rolling a 5, you need to subtract the cumulative frequency of claiming
4 monetary units from 1.0.

---
class: center middle inverse

# BioPython (CSB 6.4)

-----

# I: Retrieving sequences from NCBI (6.4.1)

&lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt;

---

## Search the database

- Import the package:
  
  ```python
  from Bio import Entrez
  ```

- provide your e-mail address to let NCBI know who you are

  ```python
  Entrez.email = "me@bigu.edu"
  ```
  
- Create a "handle" to search results:

  ```python
  handle = Entrez.esearch(db = "nuccore",
                          term = ("Uropsilus investigator[Organism]"))
  ```

- Read the results and close the handle:

  ```python
  record = Entrez.read(handle)
  handle.close()
  ```

---

## Looking at the results

- Record is a dictionary, we can look at the keys:
  
  ```python
  record.keys()
  #&gt; dict_keys(['Count', 'RetMax', 'RetStart', 'IdList',
  #&gt;            'TranslationSet', 'TranslationStack',
  #&gt;             'QueryTranslation'])
  ```
  
- How many sequences did we find?  
  
  ```python
  record["Count"]
  '71'
  ```
  
- What is the list of GenBank identifiers?

  ```python
  id_list = record["IdList"]
  print(id_list)
  #&gt; ['524853022', '555947199', '555947198', ... , '555946814']
  ```

---

## Downloading the sequences

```python
# always tell NCBI who you are
Entrez.email = "me@bigu.edu"
handle = Entrez.efetch(db = "nuccore",
rettype = "fasta",
retmode = "text",
id = id_list[:10])
# set up a handle to an output file
out_handle = open("Uropsilus_seq.fasta", "w")
# write obtained sequence data to file
for line in handle:
out_handle.write(line)
out_handle.close()
handle.close()
```

---

class: center middle inverse

# BioPython (CSB 6.4)

-----

# II: Input and output of sequence data using *SeqIO* (6.4.2)

&lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt;

---


---
class: center middle inverse

# Questions?

-----

&lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "rainbow",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
